!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.CSVParser=e()}(this,function(){"use strict";function n(n,e){return new Date(Date.UTC(n,e+1,0)).getUTCDate()}function e(e,t,i,r,u,l){return t&&(0>t||t>11)?!0:i&&(0>i||i>n(e,t))?!0:r&&(0>r||r>24||24===r&&(0!==u||0!==l))?!0:u&&(0>u||u>59)?!0:!(!l||!(0>l||l>59))}function t(n){return Number(n)+(Number(n)>68?1900:2e3)}function i(n){return r(n.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(n,e,t,i,r){return e||t||i||r}))}function r(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function u(n,e){return"NaD"!==l(n,e)}function l(n,r){n=""+n;for(let u,l=/(\[[^\[]*\])|(\\)?(yyyy|yy|mm|m|dd|d|HH|H|MM|M|SS|S|.)/g,s=r.match(l)||[],o=0,m=0,f=0,a=null,g=null,d=null,p=0;p<s.length;p++){let c=s[p];u="d"===c||"m"===c||"H"===c||"M"===c||"S"===c?/\d\d?/:"dd"===c||"mm"===c||"yy"===c||"HH"===c||"MM"===c||"SS"===c?/\d\d/:"yyyy"===c?/\d{4}/:new RegExp(i(c));let h=(n.match(u)||[])[0];if(h){let b=n.substr(0,n.indexOf(h));if(b.length>0)return"NaD";n=n.slice(n.indexOf(h)+h.length),"S"===c||"SS"===c?o=Number(h):"M"===c||"MM"===c?m=Number(h):"H"===c||"HH"===c?f=Number(h):"d"===c||"dd"===c?a=Number(h):"m"===c||"mm"===c?g=Number(h)-1:"yy"===c?d=t(h):"yyyy"===c&&(d=2===h.length?t(h):Number(h))}}return null===d||null===g||null===a||e(d,g,a,f,m,o)?"NaD":new Date(Date.UTC(d,g,a,f,m,o))}function s(n){n=n.trim();let e=n.split(",").length-1;if(e>1)return".";if(n.indexOf(" ")>=0)return",";if(n.indexOf("،")>=0)return".";if(n.indexOf("'")>=0)return".";let t=n.split(".").length-1;if(1===e&&1===t){let i=n.lastIndexOf(","),r=n.lastIndexOf(".");return r>i?".":","}if(e+t===1){let i=n.indexOf(","),r=n.indexOf("."),u=n.length;if(-1!==i&&u-i!==4)return",";if(-1!==r&&u-r!==4)return"."}return"ambiguous"}function o(n){for(let e=0;e<n.length;e++)for(let t=0;t<n[e].length;t++)if(/^[0-9.,' ،-]+$/.test(n[e][t])){let i=s(n[e][t]);if("ambiguous"!==i)return i}return"."}function m(n,e){for(let t in e)"object"==typeof e[t]?"undefined"!=typeof n[t]&&m(n[t],e[t]):n[t]=e[t];return n}function f(n,e){function t(t){return!!(0===t||n[t-1]===e.lineEnding||t>1&&"\r\n"===e.lineEnding&&"\r"===n[t-2]&&"\n"===n[t-1])}function i(t){for(;t!==s&&n[t]!==e.lineEnding&&("\r\n"!==e.lineEnding||"\r"!==n[t]||"\n"!==n[t+1]);t++);return t}let r={delimiter:",",lineEnding:"\n",comment:"#",maxRows:0,maxColumns:{numberOfColumns:-1,cutRemaining:!1}};e=m(r,e);let u=[],l=[],s=n.length;if(0===s)return u;n:for(let o=0,f=0,a=0,g=0;;f++){if(f>=s){l.push(n.substring(o,f)),l.length>0&&u.push(l);break}if(n[f]!==e.delimiter){if(n[f]===e.lineEnding||"\r\n"===e.lineEnding&&"\r"===n[f]&&"\n"===n[f+1]){if(l.push(n.substring(o,f)),u.push(l),l=[],g=0,a++,a===e.maxRows)break;"\r\n"===e.lineEnding&&(f+=1),o=f+1}else if(t(f)&&n[f]===e.comment){if(f=i(f),f===s)break;"\r\n"===e.lineEnding&&(f+=1),o=f+1}else if('"'===n[f])if(t(f)||n[f-1]===e.delimiter)for(o=f+=1;;f++){if(f===s){l.push(n.substring(o,f)),u.push(l);break n}if('"'===n[f]){if(f===s-1){l.push(n.substring(o,f).replace(/""/g,'"')),u.push(l);break n}if('"'===n[f+1]){f+=1;continue}if(n[f+1]===e.delimiter){if(g++,g===e.maxColumns.numberOfColumns){if(e.maxColumns.cutRemaining?(l.push(n.substring(o,f).replace(/""/g,'"')),f=i(f)):(f=i(f),l.push(n.substring(o,'"'===n[f-1]?f-1:f).replace(/""/g,'"').replace(/","/g,","))),u.push(l),l=[],g=0,a++,f===s||a===e.maxRows)break n;"\r\n"===e.lineEnding&&(f+=1)}else l.push(n.substring(o,f).replace(/""/g,'"')),f+=1;o=f+1;break}if(n[f+1]===e.lineEnding||"\r\n"===e.lineEnding&&"\r"===n[f+1]&&"\n"===n[f+2]){if(l.push(n.substring(o,f).replace(/""/g,'"')),u.push(l),l=[],g=0,a++,a===e.maxRows)break n;"\r\n"===e.lineEnding&&(f+=1),f+=1,o=f+1;break}}}else if(n[f+1]===e.delimiter||f===s-1){if(f+=1,g++,g===e.maxColumns.numberOfColumns){if(e.maxColumns.cutRemaining?(l.push(n.substring(o,f)),f=i(f)):(f=i(f),l.push(n.substring(o,f))),u.push(l),l=[],g=0,a++,f===s||a===e.maxRows)break;"\r\n"===e.lineEnding&&(f+=1)}else l.push(n.substring(o,f));o=f+1;continue}}else{if(g++,g===e.maxColumns.numberOfColumns){if(e.maxColumns.cutRemaining?(l.push(n.substring(o,f)),f=i(f)):(f=i(f),l.push(n.substring(o,f))),u.push(l),l=[],g=0,a++,f===s||a===e.maxRows)break;"\r\n"===e.lineEnding&&(f+=1)}else l.push(n.substring(o,f));o=f+1}}return u}function a(n,e){for(let t=[",",";","	","|",p,c],i=[],r=0;r<t.length;r++){for(let u=f(n,{delimiter:t[r],lineEnding:e,maxRows:10}),l=0,s=0,o=1e3,m=!1,a=!1,g=0;g<u.length;g++)if(""!==u[g]){let d=u[g].length;l+=d,m||(m=!0,s=u[g].length),a||(a=!0,o=Math.abs(s-d))}i.push([s,o,l,r])}return i.sort(function(n,e){let t=n[0],i=e[0],r=n[1],u=e[1],l=n[2],s=e[2];return i>t?1:t>i?-1:u>r?-1:r>u?1:s>l?1:l>s?-1:0}),t[i[0][3]]}function g(n){n=n.substr(0,1048576),n=n.replace(/"[^"]*"/g,"");let e=n.split("\n"),t=n.split("\r"),i=n.split("\r\n"),r=[{type:"\n",data:e,length:e.length-i.length},{type:"\r",data:t,length:t.length-i.length},{type:"\r\n",data:i,length:i.length-1}];return r.sort(function(n,e){return e.length-n.length}),0==r[0].length?"\n":r[0].length==r[1].length?r[0].data[0].length<=r[1].data[0].length?r[0].type:r[1].type:r[0].type}function d(n,e){let t={delimiter:"auto",lineEnding:"auto",comment:"#",convertToTypes:{convert:!1,decimalDelimiter:"auto",dateFormat:"yyyy-mm-dd"},skipEmptyLines:!1,maxRows:0,maxColumns:{numberOfColumns:-1,cutRemaining:!1}};e=m(t,e),"auto"===e.lineEnding&&(e.lineEnding=g(n)),"auto"===e.delimiter&&(e.delimiter=a(n,e.lineEnding));let i=f(n,e);if(e.skipEmptyLines)for(let r=0;r<i.length;r++)1===i[r].length&&""===i[r][0]&&i.splice(r--,1);if(e.convertToTypes.convert){"auto"===e.convertToTypes.decimalDelimiter&&(e.convertToTypes.decimalDelimiter=o(i));let s;s="."===e.convertToTypes.decimalDelimiter?/[,' ،]/g:/[\.' ،]/g;for(let r=0;r<i.length;r++)for(let d=0;d<i[r].length;d++){let p=i[r][d];"true"===p||"TRUE"===p?i[r][d]=!0:"false"===p||"FALSE"===p?i[r][d]=!1:u(p,e.convertToTypes.dateFormat)?i[r][d]=l(p,e.convertToTypes.dateFormat):/[0-9]{2}\.[0-9]{2}\./.test(p)||(p=p.replace(s,"").replace(/(.*)-/,"-$1").replace(e.convertToTypes.decimalDelimiter,"."),isNaN(Number(p))||(i[r][d]=Number(p)))}}return{options:e,data:i}}const p=String.fromCharCode(30),c=String.fromCharCode(31);return d});