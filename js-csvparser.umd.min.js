!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.CSVParser=n()}(this,function(){"use strict";function e(e,n){return new Date(Date.UTC(e,n+1,0)).getUTCDate()}function n(n,t,i,r,u,s){return t&&(0>t||t>11)?!0:i&&(0>i||i>e(n,t))?!0:r&&(0>r||r>24||24===r&&(0!==u||0!==s))?!0:u&&(0>u||u>59)?!0:!(!s||!(0>s||s>59))}function t(e){return Number(e)+(Number(e)>68?1900:2e3)}function i(e){return r(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,n,t,i,r){return n||t||i||r}))}function r(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function u(e,n){return"NaD"!==s(e,n)}function s(e,r){e=""+e;for(let u,s,l,o,m=/(\[[^\[]*\])|(\\)?(yyyy|yy|mm|m|dd|d|HH|H|MM|M|SS|S|.)/g,f=r.match(m)||[],a=0,g=0,d=0,p=0;p<f.length;p++){let c=f[p];o="d"===c||"m"===c||"H"===c||"M"===c||"S"===c?/\d\d?/:"dd"===c||"mm"===c||"yy"===c||"HH"===c||"MM"===c||"SS"===c?/\d\d/:"yyyy"===c?/\d{4}/:new RegExp(i(c));let h=(e.match(o)||[])[0];h&&(e=e.slice(e.indexOf(h)+h.length),"S"===c||"SS"===c?a=Number(h):"M"===c||"MM"===c?g=Number(h):"H"===c||"HH"===c?d=Number(h):"d"===c||"dd"===c?u=Number(h):"m"===c||"mm"===c?s=Number(h)-1:"yy"===c?l=t(h):"yyyy"===c&&(l=2===h.length?t(h):Number(h)))}return l&&s&&u&&!n(l,s,u,d,g,a)?new Date(Date.UTC(l,s,u,d,g,a)):"NaD"}function l(e){e=e.trim();let n=e.split(",").length-1;if(n>1)return".";if(e.indexOf(" ")>=0)return",";if(e.indexOf("،")>=0)return".";if(e.indexOf("'")>=0)return".";let t=e.split(".").length-1;if(1===n&&1===t){let i=e.lastIndexOf(","),r=e.lastIndexOf(".");return r>i?".":","}if(n+t===1){let i=e.indexOf(","),r=e.indexOf("."),u=e.length;if(-1!==i&&u-i!==4)return",";if(-1!==r&&u-r!==4)return"."}return"ambiguous"}function o(e){for(let n=0;n<e.length;n++)for(let t=0;t<e[n].length;t++)if(/^[0-9.,' ،-]+$/.test(e[n][t])){let i=l(e[n][t]);if("ambiguous"!==i)return i}return"."}function m(e,n){for(let t in n)"object"==typeof n[t]?"undefined"!=typeof e[t]&&m(e[t],n[t]):e[t]=n[t];return e}function f(e,n){function t(t){return!!(0===t||e[t-1]===n.lineEnding||t>1&&"\r\n"===n.lineEnding&&"\r"===e[t-2]&&"\n"===e[t-1])}function i(t){for(;t!==l&&e[t]!==n.lineEnding&&("\r\n"!==n.lineEnding||"\r"!==e[t]||"\n"!==e[t+1]);t++);return t}let r={delimiter:",",lineEnding:"\n",comment:"#",maxRows:0,maxColumns:{numberOfColumns:-1,cutRemaining:!1}};n=m(r,n);let u=[],s=[],l=e.length;if(0===l)return u;e:for(let o=0,f=0,a=0,g=0;;f++){if(f>=l){s.push(e.substring(o,f)),s.length>0&&u.push(s);break}if(e[f]!==n.delimiter){if(e[f]===n.lineEnding||"\r\n"===n.lineEnding&&"\r"===e[f]&&"\n"===e[f+1]){if(s.push(e.substring(o,f)),u.push(s),s=[],g=0,a++,a===n.maxRows)break;"\r\n"===n.lineEnding&&(f+=1),o=f+1}else if(t(f)&&e[f]===n.comment){if(f=i(f),f===l)break;"\r\n"===n.lineEnding&&(f+=1),o=f+1}else if('"'===e[f])if(t(f)||e[f-1]===n.delimiter)for(o=f+=1;;f++){if(f===l){s.push(e.substring(o,f)),u.push(s);break e}if('"'===e[f]){if(f===l-1){s.push(e.substring(o,f).replace(/""/g,'"')),u.push(s);break e}if('"'===e[f+1]){f+=1;continue}if(e[f+1]===n.delimiter){if(g++,g===n.maxColumns.numberOfColumns){if(n.maxColumns.cutRemaining?(s.push(e.substring(o,f).replace(/""/g,'"')),f=i(f)):(f=i(f),s.push(e.substring(o,'"'===e[f-1]?f-1:f).replace(/""/g,'"').replace(/","/g,","))),u.push(s),s=[],g=0,a++,f===l||a===n.maxRows)break e;"\r\n"===n.lineEnding&&(f+=1)}else s.push(e.substring(o,f).replace(/""/g,'"')),f+=1;o=f+1;break}if(e[f+1]===n.lineEnding||"\r\n"===n.lineEnding&&"\r"===e[f+1]&&"\n"===e[f+2]){if(s.push(e.substring(o,f).replace(/""/g,'"')),u.push(s),s=[],g=0,a++,a===n.maxRows)break e;"\r\n"===n.lineEnding&&(f+=1),f+=1,o=f+1;break}}}else if(e[f+1]===n.delimiter||f===l-1){if(f+=1,g++,g===n.maxColumns.numberOfColumns){if(n.maxColumns.cutRemaining?(s.push(e.substring(o,f)),f=i(f)):(f=i(f),s.push(e.substring(o,f))),u.push(s),s=[],g=0,a++,f===l||a===n.maxRows)break;"\r\n"===n.lineEnding&&(f+=1)}else s.push(e.substring(o,f));o=f+1;continue}}else{if(g++,g===n.maxColumns.numberOfColumns){if(n.maxColumns.cutRemaining?(s.push(e.substring(o,f)),f=i(f)):(f=i(f),s.push(e.substring(o,f))),u.push(s),s=[],g=0,a++,f===l||a===n.maxRows)break;"\r\n"===n.lineEnding&&(f+=1)}else s.push(e.substring(o,f));o=f+1}}return u}function a(e,n){for(let t=[",",";","	","|",p,c],i=[],r=0;r<t.length;r++){for(let u=f(e,{delimiter:t[r],lineEnding:n,maxRows:10}),s=0,l=0,o=1e3,m=!1,a=!1,g=0;g<u.length;g++)if(""!==u[g]){let d=u[g].length;s+=d,m||(m=!0,l=u[g].length),a||(a=!0,o=Math.abs(l-d))}i.push([l,o,s,r])}return i.sort(function(e,n){let t=e[0],i=n[0],r=e[1],u=n[1],s=e[2],l=n[2];return i>t?1:t>i?-1:u>r?-1:r>u?1:l>s?1:s>l?-1:0}),t[i[0][3]]}function g(e){e=e.substr(0,1048576),e=e.replace(/"[^"]*"/g,"");let n=e.split("\n"),t=e.split("\r"),i=e.split("\r\n"),r=[{type:"\n",data:n,length:n.length-i.length},{type:"\r",data:t,length:t.length-i.length},{type:"\r\n",data:i,length:i.length-1}];return r.sort(function(e,n){return n.length-e.length}),0==r[0].length?"\n":r[0].length==r[1].length?r[0].data[0].length<=r[1].data[0].length?r[0].type:r[1].type:r[0].type}function d(e,n){let t={delimiter:"auto",lineEnding:"auto",comment:"#",convertToTypes:{convert:!1,decimalDelimiter:"auto",dateFormat:"YYYY-MM-DD"},skipEmptyLines:!1,maxRows:0,maxColumns:{numberOfColumns:-1,cutRemaining:!1}};n=m(t,n),"auto"===n.lineEnding&&(n.lineEnding=g(e)),"auto"===n.delimiter&&(n.delimiter=a(e,n.lineEnding));let i=f(e,n);if(n.skipEmptyLines)for(let r=0;r<i.length;r++)1===i[r].length&&""===i[r][0]&&i.splice(r--,1);if(n.convertToTypes.convert){"auto"===n.convertToTypes.decimalDelimiter&&(n.convertToTypes.decimalDelimiter=o(i));let l;l="."===n.convertToTypes.decimalDelimiter?/[,' ،]/g:/[\.' ،]/g;for(let r=0;r<i.length;r++)for(let d=0;d<i[r].length;d++){let p=i[r][d];"true"===p||"TRUE"===p?i[r][d]=!0:"false"===p||"FALSE"===p?i[r][d]=!1:u(p,n.convertToTypes.dateFormat)?i[r][d]=s(p,n.convertToTypes.dateFormat):/[0-9]{2}\.[0-9]{2}\./.test(p)||(p=p.replace(l,"").replace(/(.*)-/,"-$1").replace(n.convertToTypes.decimalDelimiter,"."),isNaN(Number(p))||(i[r][d]=Number(p)))}}return{options:n,data:i}}const p=String.fromCharCode(30),c=String.fromCharCode(31);return d});